<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Choose Plan</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #004792, #0077cc);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.container{
    text-align:center;
    width:90%;
}

h1{
    color:white;
    margin-bottom:40px;
}

.plans{
    display:flex;
    justify-content:center;
    gap:25px;
    flex-wrap:wrap;
}

.card{
    background:white;
    width:260px;
    padding:30px;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
    transition:0.3s;
}

.card:hover{
    transform:translateY(-6px);
}

.price{
    font-size:30px;
    font-weight:bold;
    margin:15px 0;
}

.duration{
    color:#666;
    margin-bottom:20px;
}

.select-btn{
    padding:10px 20px;
    border:none;
    border-radius:6px;
    background:#004792;
    color:white;
    cursor:pointer;
}

.select-btn:hover{
    background:#003366;
}

.loader{
    margin-top:20px;
    color:white;
    display:none;
}

.success{
    margin-top:20px;
    color:yellow;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">
    <h1>Select Your Plan</h1>

    <div class="plans">

        <div class="card">
            <h2>Basic</h2>
            <div class="price">â‚¹200</div>
            <div class="duration">1 Month Access</div>
            <button class="select-btn" onclick="createPayment(200, 30)">Choose Plan</button>
        </div>

        <div class="card">
            <h2>Standard</h2>
            <div class="price">â‚¹1000</div>
            <div class="duration">6 Months Access</div>
            <button class="select-btn" onclick="createPayment(1000, 180)">Choose Plan</button>
        </div>

        <div class="card">
            <h2>Premium</h2>
            <div class="price">â‚¹2000</div>
            <div class="duration">1 Year Access</div>
            <button class="select-btn" onclick="createPayment(2000, 365)">Choose Plan</button>
        </div>

    </div>

    <div class="loader" id="loader">Generating Payment Link...</div>
    <div class="success" id="successMessage"></div>
</div>

<script>

let currentLinkId = null;
let selectedDuration = 30;

// ðŸ”¹ Create Payment Link
function createPayment(amount, durationDays){

    selectedDuration = durationDays;

    document.getElementById("loader").style.display = "block";

    fetch('https://flaskserver-3c3s.onrender.com/create-payment-link', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ amount })
    })
    .then(res => res.json())
    .then(data => {

        if(data.link_url){
            currentLinkId = data.link_id;

            window.open(data.link_url, "_blank");

            startPollingForPayment(currentLinkId);
        }else{
            alert("Error creating payment link");
        }

    })
    .catch(err=>{
        console.error(err);
        alert("Server error");
    });
}


// ðŸ”¹ Poll Payment Status
function startPollingForPayment(linkId){

    const interval = setInterval(() => {

        fetch(`https://flaskserver-3c3s.onrender.com/check-payment/${linkId}`)
        .then(res => res.json())
        .then(data => {

            if(data.status === "success"){
                clearInterval(interval);
                document.getElementById("loader").style.display = "none";
                document.getElementById("successMessage").innerHTML = "âœ… Payment Confirmed!";

                verifyAndSave();
            }

        })
        .catch(err=>{
            console.error("Polling error:", err);
        });

    }, 3000);
}


// ðŸ”¹ Save Pass After Payment
function verifyAndSave(){

    alert("data saved...")
}

</script>

</body>
</html>